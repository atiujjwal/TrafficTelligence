<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Predict hourly traffic volume with weather intelligence."
    />
    <title>TrafficTelligence | Volume Estimation</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='index.css') }}"
    />
  </head>
  <body>
    <div class="scene-container">
      <div class="animated-sky"></div>
      <i
        class="fas fa-cloud floating-icon"
        style="left: 10%; animation-duration: 15s"
      ></i>
      <i
        class="fas fa-wind floating-icon"
        style="left: 80%; animation-duration: 12s"
      ></i>

      <div class="road">
        <div class="road-lines"></div>
        <div class="vehicle lane-1"><i class="fas fa-car-side"></i></div>
        <div class="vehicle lane-1"><i class="fas fa-truck-pickup"></i></div>
        <div class="vehicle lane-1"><i class="fas fa-motorcycle"></i></div>
        <div class="vehicle lane-2"><i class="fas fa-bus-alt"></i></div>
        <div class="vehicle lane-2"><i class="fas fa-car-side"></i></div>
      </div>
    </div>

    <div class="main-wrapper">
      <header>
        <h1>TrafficTelligence</h1>
        <p>Advanced Volume Estimation</p>
      </header>

      <form action="{{ url_for('predict') }}" method="post" id="trafficForm">
        <div class="form-grid">
          <div class="form-group full-width">
            <label>üìÖ Travel Date & Time</label>
            <input type="datetime-local" id="ui_datetime" required />
          </div>

          <div class="form-group">
            <label>üéâ Holiday</label>
            <select id="ui_holiday" required>
              <option value="7" selected>None</option>
              <option value="1">Columbus Day</option>
              <option value="10">Veterans Day</option>
              <option value="9">Thanksgiving</option>
              <option value="0">Christmas</option>
              <option value="6">New Years</option>
              <option value="11">Washington's Birthday</option>
              <option value="5">Memorial Day</option>
              <option value="2">Independence Day</option>
              <option value="8">State Fair</option>
              <option value="3">Labor Day</option>
              <option value="4">Martin Luther King Jr Day</option>
            </select>
          </div>

          <div class="form-group">
            <label>‚õÖ Weather</label>
            <select id="ui_weather" required>
              <option value="" disabled selected>Condition...</option>
              <option value="0">Clear</option>
              <option value="1">Clouds</option>
              <option value="6">Rain</option>
              <option value="8">Snow</option>
              <option value="3">Fog</option>
              <option value="2">Drizzle</option>
              <option value="5">Mist</option>
              <option value="4">Haze</option>
              <option value="10">Thunderstorm</option>
              <option value="9">Squall</option>
              <option value="7">Smoke</option>
            </select>
          </div>

          <div class="form-group">
            <label>üå°Ô∏è Temp <span class="unit">(K)</span></label>
            <input
              type="number"
              id="ui_temp"
              step="0.01"
              placeholder="e.g. 288"
              required
            />
          </div>

          <div class="form-group">
            <label>üåßÔ∏è Rain <span class="unit">(mm)</span></label>
            <input
              type="number"
              id="ui_rain"
              min="0"
              max="1000"
              value="0"
              required
            />
          </div>

          <div class="form-group">
            <label>‚ùÑÔ∏è Snow <span class="unit">(mm)</span></label>
            <input
              type="number"
              id="ui_snow"
              min="0"
              max="1000"
              value="0"
              required
            />
          </div>
        </div>

        <input type="hidden" name="holiday" id="h_holiday" />
        <input type="hidden" name="temp" id="h_temp" />
        <input type="hidden" name="rain" id="h_rain" />
        <input type="hidden" name="snow" id="h_snow" />
        <input type="hidden" name="weather" id="h_weather" />
        <input type="hidden" name="Day" id="h_day" />
        <input type="hidden" name="Month" id="h_month" />
        <input type="hidden" name="Year" id="h_year" />
        <input type="hidden" name="Hours" id="h_hours" />
        <input type="hidden" name="Minutes" id="h_minutes" />
        <input type="hidden" name="Seconds" id="h_seconds" />

        <button type="submit" class="submit-btn">Estimate Traffic</button>

        {% if prediction_text %}
        <div class="prediction-result">{{ prediction_text }}</div>
        {% endif %}
      </form>
    </div>

    <script>
      window.onload = function () {
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById("ui_datetime").value = now
          .toISOString()
          .slice(0, 16);
      };

      const form = document.getElementById("trafficForm");
      form.addEventListener("submit", function (e) {
        // e.preventDefault(); // Commented out to allow form submission to Flask

        const dtValue = new Date(document.getElementById("ui_datetime").value);
        document.getElementById("h_holiday").value =
          document.getElementById("ui_holiday").value;
        document.getElementById("h_temp").value =
          document.getElementById("ui_temp").value;
        document.getElementById("h_rain").value =
          document.getElementById("ui_rain").value;
        document.getElementById("h_snow").value =
          document.getElementById("ui_snow").value;
        document.getElementById("h_weather").value =
          document.getElementById("ui_weather").value;
        document.getElementById("h_day").value = dtValue.getDate();
        document.getElementById("h_month").value = dtValue.getMonth() + 1;
        document.getElementById("h_year").value = dtValue.getFullYear();
        document.getElementById("h_hours").value = dtValue.getHours();
        document.getElementById("h_minutes").value = dtValue.getMinutes();
        document.getElementById("h_seconds").value = "0";
      });
    </script>
  </body>
</html>
